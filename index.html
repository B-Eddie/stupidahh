<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>A-Frame FPS (Desktop + Quest 3)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Official A-Frame CDN (pinned 1.7.0) -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <!-- Local extras (remove if not needed) -->
    <script src="vendor/aframe-extras.min.js"></script>
  </head>

  <body style="margin: 0">
    <div
      class="hud"
      style="
        position: fixed;
        top: 8px;
        left: 12px;
        color: #3eff8c;
        font-family: monospace;
        font-size: 12px;
        text-shadow: 0 0 4px #2aff65;
        pointer-events: none;
        z-index: 10;
      "
    >
      ROUND <span id="roundNum">1</span> | HAZARDS
      <span id="hazCount">0</span> | DAMAGE <span id="damageCount">0/5</span>
    </div>
    <div
      id="gooseVoiceHud"
      style="
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: #ff6b6b;
        font-family: monospace;
        font-size: 14px;
        text-shadow: 0 0 6px #ff0000;
        pointer-events: none;
        z-index: 10;
        opacity: 0;
        transition: opacity 0.3s ease;
        background: rgba(0, 0, 0, 0.7);
        padding: 8px 16px;
        border-radius: 8px;
        border: 2px solid #ff6b6b;
        max-width: 80%;
        text-align: center;
      "
    >
      <div style="font-size: 12px; color: #ffaa00; margin-bottom: 4px">
        ðŸ¦¢ GOOSE SAYS:
      </div>
      <div id="gooseVoiceText"></div>
    </div>
    <a-scene
      round-manager="spawnBoxes:false"
      renderer="antialias: true; physicallyCorrectLights: true"
      webxr="optionalFeatures: local-floor, bounded-floor, hand-tracking, layers"
      background="color: #1c1f24"
      cursor="rayOrigin: mouse"
    >
      <a-assets timeout="15000">
        <a-asset-item id="gooseModel" src="assets/goose.glb"></a-asset-item>
      </a-assets>
      <a-entity
        id="mapRoot"
        tactical-map="size:60; obstacleDensity:0.7; platformCount:8; wallCount:12; coverCount:15"
        tactical-lighting
        goose-spawn-manager-with-voice="scale:0.35; voiceEnabled:true; voiceProximityRadius:5.0"
        hazard-damage
      ></a-entity>
      <!-- Lighting -->
      <a-entity light="type: hemisphere; intensity: 0.6"></a-entity>
      <a-entity
        light="type: directional; intensity: 0.8"
        position="1 3 2"
      ></a-entity>

      <!-- Ground is now handled by tactical-map component -->

      <!-- PLAYER RIG -->
      <!-- movement-controls (from aframe-extras) gives:
           - Desktop: WASD + Shift, mouse-look
           - VR (Quest 3): left thumbstick for smooth locomotion
      -->
      <a-entity
        id="rig"
        movement-controls="fly: false; speed: 0.14"
        player-recorder
        player-health
        player-collision="width:0.6; depth:0.6; height:1.7"
  player-spawn-center="groundY:0; offsetX:10; offsetZ:0; epsilon:0.03; debug:true"
      >
        <a-entity
          id="camera"
          camera
          position="0 1.6 0"
          look-controls="pointerLockEnabled: true"
          player-hittable
        ></a-entity>

        <!-- Left hand: locomotion only (no gun) -->
        <!-- oculus-touch-controls maps fine to Quest 3 controllers -->
        <a-entity
          id="leftHand"
          hand-controls="hand: left; handModelStyle: lowPoly; color: #bbb"
          oculus-touch-controls="hand: left"
          vive-controls="hand: left"
          windows-motion-controls="hand: left"
        >
        </a-entity>

        <!-- Right hand: hold the gun and shoot with trigger -->
        <a-entity
          id="rightHand"
          hand-controls="hand: right; handModelStyle: lowPoly; color: #ddd"
          oculus-touch-controls="hand: right"
          vive-controls="hand: right"
          windows-motion-controls="hand: right"
          hitscan-gun
        >
          <!-- Simple â€œgunâ€ placeholder; replace with your GLB model -->
          <a-box
            position="0 -0.02 -0.08"
            depth="0.24"
            height="0.06"
            width="0.06"
            color="#222"
          ></a-box>
          <a-cylinder
            position="0 -0.02 -0.22"
            radius="0.02"
            height="0.2"
            rotation="90 0 0"
            color="#333"
          ></a-cylinder>
        </a-entity>
      </a-entity>

      <!-- Enter/exit VR button is built-in; Quest 3 users tap it to switch into VR -->
    </a-scene>

    <script>
      // Helper to ensure AFRAME is available before registering components
      window.aframeReady = function (cb) {
        if (window.AFRAME) return cb();
        const check = () => {
          if (window.AFRAME) {
            cb();
          } else {
            requestAnimationFrame(check);
          }
        };
        check();
      };
    </script>
    <script src="hitscanGun.js" defer></script>
    <script src="hittable.js" defer></script>
    <script src="enemy.js" defer></script>
    <script src="playerHittable.js" defer></script>
  <script src="playerRecorder.js" defer></script>
  <script src="playerCollision.js" defer></script>
    <script src="ghostReplay.js" defer></script>
    <script src="roundManager.js" defer></script>
    <script src="gridMaterial.js" defer></script>
    <script src="map.js" defer></script>
    <script src="gooseEnemies.js" defer></script>
    <script src="gooseVoice.js" defer></script>
  <script src="tacticalMap.js" defer></script>
  <script src="playerSpawnCenter.js" defer></script>
    <script src="playerHealth.js" defer></script>
    <script src="gooseTimeline.js" defer></script>
  </body>
</html>
